# Copyright 2025 Beijing Jiaotong University (BJTU). All rights reserved.

import cv2
import numpy as np

# --------------------------------------------------------------------------- #
# Calibration data (2024-12-27, Camera 7)
# --------------------------------------------------------------------------- #
# LEFT_CAMERA_MATRIX = np.array([
#     [446.1312, -0.1607, 360.5116],
#     [0, 446.5769, 308.2938],
#     [0, 0, 1.0000]
# ])

# RIGHT_CAMERA_MATRIX = np.array([
#     [445.7741, 0.1990, 342.0431],
#     [0, 446.7158, 283.7390],
#     [0, 0, 1.0000]
# ])

# LEFT_DISTORTION = np.array([-0.229800, 0.140721, 0.001900, -0.000648, -0.029280])
# RIGHT_DISTORTION = np.array([-0.220908, 0.111177, 0.000023, -0.000142, -0.009207])

# R = np.array([
#     [1.0000, -0.0044, -0.0053],
#     [0.0044, 0.9999, 0.0098],
#     [0.0052, -0.0099, 0.9999]
# ])

# T = np.array([-95.7117, -0.3257, -0.4032])

# --------------------------------------------------------------------------- #
# Calibration data (2025-10-22, Camera 1)
# --------------------------------------------------------------------------- #

LEFT_CAMERA_MATRIX = np.array([
    [332.596605251971, 0, 336.960410096591],
    [0,	332.721697542652, 285.417204291947], 
    [0, 0, 1]
])

RIGHT_CAMERA_MATRIX = np.array([
    [330.297799241800,	0,	346.573648139049], 
    [0,	330.382626249859,	313.797581870513],	
    [0, 0,	1]
])

LEFT_DISTORTION = np.array([-0.333609329151093, 0.150787547626204, 0.0, 0.0, -0.0379435180646588])
RIGHT_DISTORTION = np.array([-0.335305559695400, 0.156512059986725, 0, 0, -0.0401582850698159])

R = np.array([
    [0.998210290350346, 0.0541302731066292, -0.0254190828331753],
    [-0.0543092154712939, 0.998503639673937, -0.00640239586354962], 
    [0.0250344832894681, 0.00777142788056134, 0.999656380740466]
])

T = np.array([-99.4473212964733, 3.21585861235121, -0.141563116032156])

SIZE = (640, 480)

# --------------------------------------------------------------------------- #
# Rectification maps
# --------------------------------------------------------------------------- #
R1, R2, P1, P2, Q, _, _ = cv2.stereoRectify(
    LEFT_CAMERA_MATRIX, LEFT_DISTORTION,
    RIGHT_CAMERA_MATRIX, RIGHT_DISTORTION,
    SIZE, R, T, alpha=0
)

LEFT_MAP1, LEFT_MAP2 = cv2.initUndistortRectifyMap(
    LEFT_CAMERA_MATRIX, LEFT_DISTORTION, R1, P1, SIZE, cv2.CV_16SC2
)
RIGHT_MAP1, RIGHT_MAP2 = cv2.initUndistortRectifyMap(
    RIGHT_CAMERA_MATRIX, RIGHT_DISTORTION, R2, P2, SIZE, cv2.CV_16SC2
)